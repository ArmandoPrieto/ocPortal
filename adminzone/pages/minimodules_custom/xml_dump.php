<?php /*

 ocPortal
 Copyright (c) ocProducts, 2004-2012

 See text/EN/licence.txt for full licencing information.


 NOTE TO PROGRAMMERS:
   Do not edit this file. If you need to make changes, save your changed file to the appropriate *_custom folder
   **** If you ignore this advice, then your website upgrades (e.g. for bug fixes) will likely kill your changes ****

*/

disable_php_memory_limit();
$GLOBALS['NO_DB_SCOPE_CHECK']=true;

$filename='ocportal-'.get_site_name().'.'.date('Y-m-d').'.sql';

if (!isset($_GET['testing']))
{
	header('Content-Type: application/octet-stream'.'; authoritative=true;');
	if (strstr(ocp_srv('HTTP_USER_AGENT'),'MSIE')!==false)
		header('Content-Disposition: filename="'.str_replace(chr(13),'',str_replace(chr(10),'',addslashes($filename))).'"');
	else
		header('Content-Disposition: attachment; filename="'.str_replace(chr(13),'',str_replace(chr(10),'',addslashes($filename))).'"');
} else
{
	header('Content-type: text/plain');
}

require_code('xml_dump');

$st=get_sql_dump();
foreach ($st as $s)
{
	echo $s;
	echo "\n\n";
}

$GLOBALS['SCREEN_TEMPLATE_CALLED']='';
exit();
