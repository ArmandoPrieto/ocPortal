<?php /*

 ocPortal
 Copyright (c) ocProducts, 2004-2013

 See text/EN/licence.txt for full licencing information.


 NOTE TO PROGRAMMERS:
   Do not edit this file. If you need to make changes, save your changed file to the appropriate *_custom folder
   **** If you ignore this advice, then your website upgrades (e.g. for bug fixes) will likely kill your changes ****

*/

/**
 * @license		http://opensource.org/licenses/cpal_1.0 Common Public Attribution License
 * @copyright	ocProducts Ltd
 * @package		core_ocf
 */

require_code('content_fs');

class Hook_occle_fs_groups extends content_fs_base
{
	var $folder_content_type='group';
	var $file_content_type='member';

	/**
	 * Standard modular add function for content hooks. Adds some content with the given title and properties.
	 *
	 * @param  SHORT_TEXT	Content title
	 * @param  ID_TEXT		Parent category (blank: root / not applicable)
	 * @param  array			Properties (may be empty, properties given are open to interpretation by the hook but generally correspond to database fields)
	 * @return ID_TEXT		The content ID
	 */
	function _folder_add($title,$category,$properties)
	{
		require_code('ocf_groups_action');

		$is_default=$this->_default_property_int($properties,'is_default');
		$is_super_admin=$this->_default_property_int($properties,'is_super_admin');
		$is_super_moderator=$this->_default_property_int($properties,'is_super_moderator');
		$real_title=$this->_default_property_str($properties,'title');
		$rank_image=$this->_default_property_str($properties,'rank_image');
		$promotion_target=$this->_default_property_int_null($properties,'promotion_target');
		$promotion_threshold=$this->_default_property_int_null($properties,'promotion_threshold');
		$group_leader=$this->_default_property_int_null($properties,'group_leader');
		$flood_control_submit_secs=$this->_default_property_int($properties,'flood_control_submit_secs');
		$flood_control_access_secs=$this->_default_property_int($properties,'flood_control_access_secs');
		$max_daily_upload_mb=$this->_default_property_int_null($properties,'max_daily_upload_mb');
		if (is_null($max_daily_upload_mb)) $max_daily_upload_mb=70;
		$max_attachments_per_post=$this->_default_property_int_null($properties,'max_attachments_per_post');
		if (is_null($max_attachments_per_post)) $max_attachments_per_post=50;
		$max_avatar_width=$this->_default_property_int_null($properties,'max_avatar_width');
		if (is_null($max_avatar_width)) $max_avatar_width=100;
		$max_avatar_height=$this->_default_property_int_null($properties,'max_avatar_height');
		if (is_null($max_avatar_height)) $max_avatar_height=100;
		$max_post_length_comcode=$this->_default_property_int_null($properties,'max_post_length_comcode');
		if (is_null($max_post_length_comcode)) $max_post_length_comcode=30000;
		$max_sig_length_comcode=$this->_default_property_int_null($properties,'max_sig_length_comcode');
		if (is_null($max_sig_length_comcode)) $max_sig_length_comcode=7000;
		$gift_points_base=$this->_default_property_int($properties,'gift_points_base');
		$gift_points_per_day=$this->_default_property_int($properties,'gift_points_per_day');
		$enquire_on_new_ips=$this->_default_property_int($properties,'enquire_on_new_ips');
		$is_presented_at_install=$this->_default_property_int($properties,'is_presented_at_install');
		$hidden=$this->_default_property_int($properties,'hidden');
		$order=$this->_default_property_int_null($properties,'order');
		if (is_null($order)) $order=$GLOBALS['FORUM_DB']->query_select_value('f_groups','MAX(g_order)')+1;
		$rank_image_pri_only=$this->_default_property_int($properties,'rank_image_pri_only');
		$open_membership=$this->_default_property_int($properties,'open_membership');
		$is_private_club=$this->_default_property_int($properties,'is_private_club');
		$id=ocf_make_group($title,$is_default,$is_super_admin,$is_super_moderator,$real_title,$rank_image,$promotion_target,$promotion_threshold,$group_leader,$flood_control_submit_secs,$flood_control_access_secs,$max_daily_upload_mb,$max_attachments_per_post,$max_avatar_width,$max_avatar_height,$max_post_length_comcode,$max_sig_length_comcode,$gift_points_base,$gift_points_per_day,$enquire_on_new_ips,$is_presented_at_install,$hidden,$order,$rank_image_pri_only,$open_membership,$is_private_club);
		return strval($id);
	}

	/**
	 * Standard modular delete function for content hooks. Deletes the content.
	 *
	 * @param  ID_TEXT	The content ID
	 */
	function _folder_delete($content_id)
	{
		require_code('ocf_groups_action2');
		ocf_delete_group(intval($content_id));
	}

	/**
	 * Standard modular add function for content hooks. Adds some content with the given title and properties.
	 *
	 * @param  SHORT_TEXT	Content title
	 * @param  ID_TEXT		Parent category (blank: root / not applicable)
	 * @param  array			Properties (may be empty, properties given are open to interpretation by the hook but generally correspond to database fields)
	 * @return ID_TEXT		The content ID
	 */
	function _file_add($title,$category,$properties)
	{
		require_code('ocf_members_action');

		$password=$this->_default_property_str($properties,'password');
		$email_address=$this->_default_property_str($properties,'email_address');
		$groups=array();
		$groups[]=$this->_integer_category($category);
		if ((isset($properties['groups'])) && ($properties['groups']!=''))
			$groups=array_merge($groups,array_map('intval',explode(',',$properties['groups'])));
		$dob_day=$this->_default_property_int_null($properties,'dob_day');
		$dob_month=$this->_default_property_int_null($properties,'dob_month');
		$dob_year=$this->_default_property_int_null($properties,'dob_year');
		$custom_fields=array(); // TODO
		$timezone=$this->_default_property_str_null($properties,'timezone');
		$primary_group=$this->_default_property_int_null($properties,'primary_group');
		$validated=$this->_default_property_int($properties,'validated');
		$join_time=$this->_default_property_int_null($properties,'join_time');
		$last_visit_time=$this->_default_property_int_null($properties,'last_visit_time');
		$theme=$this->_default_property_str($properties,'theme');
		$avatar_url=$this->_default_property_str($properties,'avatar_url');
		$signature=$this->_default_property_str($properties,'signature');
		$is_perm_banned=$this->_default_property_int($properties,'is_perm_banned');
		$preview_posts=$this->_default_property_int($properties,'preview_posts');
		$reveal_age=$this->_default_property_int($properties,'reveal_age');
		$real_title=$this->_default_property_str($properties,'title');
		$photo_url=$this->_default_property_str($properties,'photo_url');
		$photo_thumb_url=$this->_default_property_str($properties,'photo_thumb_url');
		$views_signatures=$this->_default_property_int($properties,'views_signatures');
		$auto_monitor_contrib_content=$this->_default_property_int($properties,'auto_monitor_contrib_content');
		$language=$this->_default_property_str_null($properties,'language');
		$allow_emails=$this->_default_property_int_null($properties,'allow_emails');
		if (is_null($allow_emails)) $allow_emails=1;
		$allow_emails_from_staff=$this->_default_property_int_null($properties,'allow_emails_from_staff');
		if (is_null($allow_emails_from_staff)) $allow_emails_from_staff=1;
		$ip_address=$this->_default_property_str_null($properties,'ip_address');
		$validated_email_confirm_code=$this->_default_property_str($properties,'validated_email_confirm_code');
		$password_compatibility_scheme=$this->_default_property_str_null($properties,'password_compatibility_scheme');
		$salt=$this->_default_property_str($properties,'salt');
		$zone_wide=$this->_default_property_int($properties,'zone_wide');
		$last_submit_time=$this->_default_property_int_null($properties,'last_submit_time');
		$highlighted_name=$this->_default_property_int($properties,'highlighted_name');
		$pt_allow=$this->_default_property_str($properties,'pt_allow');
		$pt_rules_text=$this->_default_property_str($properties,'pt_rules_text');
		$id=ocf_make_member($title,$password,$email_address,$groups,$dob_day,$dob_month,$dob_year,$custom_fields,$timezone,$primary_group,$validated,$join_time,$last_visit_time,$theme,$avatar_url,$signature,$is_perm_banned,$preview_posts,$reveal_age,$real_title,$photo_url,$photo_thumb_url,$views_signatures,$auto_monitor_contrib_content,$language,$allow_emails,$allow_emails_from_staff,$ip_address,$validated_email_confirm_code,false,$password_compatibility_scheme,$salt,$zone_wide,$last_submit_time,NULL,$highlighted_name,$pt_allow,$pt_rules_text);
		return strval($id);
	}

	/**
	 * Standard modular delete function for content hooks. Deletes the content.
	 *
	 * @param  ID_TEXT	The content ID
	 */
	function _file_delete($content_id)
	{
		require_code('ocf_members_action2');
		ocf_delete_member(intval($content_id));
	}
}
